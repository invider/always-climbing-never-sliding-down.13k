<!DOCTYPE html>
<html>
    <head>
        <title>Liminal</title>

        <style>
            * {
                margin: 0;
                padding: 0;
            }
            body {
                overflow: hidden;
                background-color: #000000;
            }
            canvas {
                border: 0px;
                position: absolute;
                display: block;
            }
        </style>

        <script id="v-shader" type="x-shader/x-vertex">
            uniform mat4 mMatrix;
            uniform mat4 nMatrix;
            uniform mat4 vMatrix;
            uniform mat4 pMatrix;

            attribute vec3 aVertexPosition;
            attribute vec3 aVertexNormal;
            //attribute vec3 aVertexColor;

            varying vec3 vWorldPosition;
            varying vec3 vNormal;
            varying vec3 vWorldNormal;

            void main(void) {
                vWorldPosition = (mMatrix * vec4(aVertexPosition, 1.0)).xyz;
                vNormal = aVertexNormal;
                vWorldNormal = (nMatrix * vec4(aVertexNormal, 1.0)).xyz;

                gl_Position = pMatrix * vMatrix * mMatrix * vec4(aVertexPosition, 1.0);
            }
        </script>

        <script id="f-shader" type="x-shader/x-fragment">
            precision highp float;

            // matrices
            uniform highp mat4 mMatrix;
            uniform highp mat4 nMatrix;
            uniform highp mat4 vMatrix;
            uniform highp mat4 pMatrix;

            // environment
            uniform vec3 uCamPos;
            uniform highp vec3 uDirectionalLightVector;
            uniform highp vec4 uDirectionalLightColorI;
            uniform highp vec3 uPointLightPosition;
            uniform highp vec4 uPointLightColorI;

            // material
            uniform highp vec3 uAmbientColor;
            uniform highp vec3 uDiffuseColor;
            uniform highp vec3 uSpecularColor;
            uniform highp vec3 uEmissionColor;

            uniform highp vec4 uLightIntensities;
            uniform highp float uShininess;

            varying vec3 vWorldPosition;
            varying vec3 vNormal;
            varying vec3 vWorldNormal;

            void main(void) {
                // DEBUG material props
                highp float opacity = 1.0;
                highp float roughness = 1.0;
                // <<<--- must be set by uniforms

                highp vec3 worldNormal = normalize(vWorldNormal);

                // TODO expand into a 3-component vector with dir light colors included
                highp float diffuseDirectionalLambert = max(
                    dot(worldNormal, uDirectionalLightVector),
                    0.0
                ) * uDirectionalLightColorI.w;

                // do one point light
                highp vec3 pointLightDirection = normalize(uPointLightPosition - vWorldPosition);
                highp float diffusePointLambert = max(
                    dot(worldNormal, pointLightDirection),
                    0.0
                ) * uPointLightColorI.w;

                // mix directional and point lights factors
                highp float diffuseLambert = diffuseDirectionalLambert + diffusePointLambert;

                // specular
                vec3 eyeDirection = normalize(uCamPos - vWorldPosition);
                highp vec3 halfVector = normalize(pointLightDirection + eyeDirection);

                highp float specular = pow(
                    max( dot(worldNormal, halfVector), 0.0 ), uShininess
                ) * uPointLightColorI.w;

                gl_FragColor = vec4(
                    uAmbientColor * uLightIntensities.x
                    + uDiffuseColor * diffuseLambert * uLightIntensities.y
                    + uSpecularColor * specular * uLightIntensities.z,
                    opacity);
            }
        </script>

        <script src="js/math.js"></script>
        <script src="js/util.js"></script>
        <script src="js/geo.js"></script>

        <script src="js/dna/Frame.js"></script>
        <script src="js/dna/Camera.js"></script>
        <script src="js/dna/Cube.js"></script>
        <script src="js/dna/Mesh.js"></script>

        <script src="js/env.js"></script>
        <script src="js/trap.js"></script>
        <script src="js/setup.js"></script>
        <script src="js/scene.js"></script>
        <script src="js/cycle.js"></script>

        <script src="box/box1.js"></script>
    </head>

    <body>
        <canvas id="canvas"></canvas>
        <canvas id="hcanvas"></canvas>
    </body>
</html>
